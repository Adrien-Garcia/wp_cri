<VirtualHost *:80>
  ServerName ${SERVER_NAME}
  ServerAlias images-${SERVER_NAME}
  ServerAlias static-${SERVER_NAME}

   RewriteEngine On
   RewriteCond %{HTTPS} off
   RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI}

</VirtualHost>

<VirtualHost *:443>
  ServerName ${SERVER_NAME}
  ServerAlias static-${SERVER_NAME}
  ServerAlias images-${SERVER_NAME}

  DocumentRoot "/var/www/html"

  SSLEngine On
  SSLCertificateFile /certs/my-certificate.crt
  SSLCertificateKeyFile /certs/my-certificate.key

  # proxy for uploads: redirects to online files if do not exist locally
  RewriteEngine on
  RewriteCond %{REQUEST_URI} ^/wp-content/uploads/[^\/]*/.*$
  RewriteCond %{DOCUMENT_ROOT}%{REQUEST_FILENAME} !-f
  RewriteRule ^(.*)$ https://www.cridon-lyon.fr/$1 [QSA,L]

  <Directory "/var/www/html">
    Options Indexes FollowSymLinks
    AllowOverride all
    Order deny,allow
    Allow from all
  </Directory>

  # for static-${SERVER_NAME} resources :
  <FilesMatch "\.(cur|gif|ico|jpe?g|png|svgz?|webp)$">
     SetEnvIf Origin ":" IS_CORS
     Header set Access-Control-Allow-Origin "*" env=IS_CORS
  </FilesMatch>

  # Allow access from all domains for web fonts
  <FilesMatch "\.(eot|otf|ttc|ttf|woff2?)$">
    Header set Access-Control-Allow-Origin "*"
  </FilesMatch>

   ## Logging
   ErrorLog "/dev/stderr"
   ServerSignature Off
   CustomLog "/dev/stdout" combined

</VirtualHost>

# JETPULP - Add header security policy - do not remove
Header always set X-Content-Type-Options "nosniff"
Header always set X-XSS-Protection "1; mode=block"
Header always set X-Frame-Options "SAMEORIGIN"
